$(function(){$(".block-video .has-danmu").showDanmu(),$(".module-video-big .has-danmu").showDanmu({lines:5,lineHeight:30});var a=function(a,t,e){var n=a,d=n.data().nav,i=n.closest("[data-tab]");t&&t(),n.addClass("active").siblings("a").removeClass("active"),i.find("[data-con]").addClass("hidden").filter('[data-con="'+d+'"]').removeClass("hidden")};$("[data-nav]").click(function(){var t=$(this),e=t.data().nav,n=t.closest("[data-tab]");n.hasClass("module-article")?a(t,function(){if(t.hasClass("active")){var a="/v/list"+e+"/index.htm";a=window.globalConfig.rootDomain?window.globalConfig.rootDomain+a:a,t.attr("href",a).attr("target","_blank")}else t.attr("href","javascript:;").removeAttr("target")}):a(t)});var t=$("#slider-big"),e=t.find(".slider-item"),n=t.find(".slider-con"),d=e.length;if(d>1){for(var i="",o=0;d>o;o++)i+="<span>"+(o+1)+"</span>";t.append('<div class="slider-count">'+i+"</div>");var c,r=0,s=function(a){var i=e.width();n.width(e.width()*d),n.animate({left:-i*a}),t.find(".slider-count span").eq(a).addClass("active").siblings("span").removeClass("active")},l=function(){c=setInterval(function(){s(r),r>=d-1?r=0:r++},3e3)};s(0),l(),t.hover(function(){clearInterval(c)},function(){l()}),t.on("click",".slider-count span",function(){r=$(this).index(),s(r)})}$.cookie("viewBeta",1,{domain:".acfun.tv",expires:30}),$(".back-old").click(function(){$.cookie("viewBeta",0,{domain:".acfun.tv",expires:30})}),window.sa&&sa.track("HomePage",{from:document.referrer,firstPage:window.saObj.isFirstPage});var m=function(){var a=$("#temp-change-video").html(),t=$(a).addClass("[recommendClass]");return t[0].outerHTML}();$(".area-change-btn span").click(function(){var a=$(this),t=a.closest(".area-channel"),e=t.find(".module-video"),n=t.attr("data-cid"),d=e.attr("data-pagecount"),i=parseInt(e.attr("data-showlength")),o=t.find("script.json-channel-change"),c=a.closest(".area-change-btn"),r=50;if(c.hasClass("loading"))return!1;a.data().page=a.data().page||0,a.data().recommendData=$.parseJson(t.find("script.json-channel-recommend").html())||[],a.data().recommendPage=void 0==a.data().recommendPage?0:a.data().recommendPage,a.data().changeData=a.data().changeData||[],a.data().changeDataOld=$.parseJson(o.html())||[],a.data().changeStart=a.data().changeStart||0;var s={start:function(){c.addClass("loading")},stop:function(){setTimeout(function(){c.removeClass("loading")},1e3)}};s.start();var l=function(){var t=a.data().recommendPage,e=a.data().recommendData.slice(t*d,(t+1)*d);return e.length<=0&&(a.data().recommendPage=0,t>0&&(e=l())),e};a.data().recommendPage+=1;var g=function(){var t=l(),e=i-t.length,n=a.data().changeStart+e,d=a.data().changeData.slice(a.data().changeStart,n),o=e-d.length;if(o>0){if(!a.data().lock)return f(function(){h()}),!1;var c=a.data().changeData.slice(0,o);d=d.concat(c),n=o}return a.data().changeStart=n,t.concat(d).sort(function(){return Math.random()>.5?-1:1})},h=function(){var a=g();if(a){var t="";$.each(a,function(a,e){e.recommendClass=e.isCrown?"is-recommend":"",t+=$.parseTemp(m,e)}),e.html(t),e.find("img[data-original]").lazyload({threshold:200,effect:"fadeIn",failure_limit:50}),s.stop()}},f=function(t){$.getHttp("/index/change",{channelId:n,page:a.data().page+1},function(e){var n=e.data,d=n.hits,i=[];n.total<r?(a.data().lock=!0,i=$.removeRepeatObject(a.data().changeDataOld,d,"videoId"),i=i.concat(a.data().changeDataOld)):i=d,a.data().page=a.data().page+1,i=$.removeRepeatObject(a.data().recommendData,i,"videoId");var o=[];o=1==a.data().page?a.data().changeDataOld:a.data().changeData,i=$.removeRepeatObject(o,i,"videoId"),a.data().changeData=a.data().changeData.concat(i),t&&t()},function(){s.stop(),$.info.error("获取数据失败!")})};h()})});